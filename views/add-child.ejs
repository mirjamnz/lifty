<!--views/add-child.ejs -->
<%- include('partials/header1') %>
<%- include('partials/navbar1') %>

<!-- Main Content -->
<div class="container py-5">
  <h2 class="mb-4">ğŸ‘§ Add a Child or ğŸ« Organizations</h2>
 
<% if (session.success) { %>
  <div class="alert alert-success alert-dismissible fade show" role="alert">
    <%= session.success %>
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
  </div>
  <% session.success = null; %>
<% } %>

    <!-- Add Organizations via Button -->
    <p class="mt-2">
  Can't find your school/club/event?
  <a href="/organizations/add" class="btn btn-sm btn-outline-primary">Add New</a>
</p>
    <!-- Hidden User ID Field -->
    <input type="hidden" name="user_id" value="<%= session.userId %>">

    <div class="mb-3">
      <label for="name" class="form-label">Child Name</label>
      <input type="text" name="name" id="name" class="form-control" required>
    </div>
    <div class="mb-3">
      <label for="school" class="form-label">School</label>
      <input type="text" name="school" id="school" class="form-control" required>
    </div>
    <div class="mb-3">
      <label for="club" class="form-label">Club (optional)</label>
      <input type="text" name="club" id="club" class="form-control">
    </div>
    <button type="submit" class="btn btn-primary">Add Child</button>
  </form>
</div>
<form action="/add-child" method="POST" class="row g-3">
  <div class="col-md-6">
    <label for="childName">Child Name</label>
    <input type="text" name="name" id="childName" class="form-control" required>
  </div>

  <div class="col-md-6">
    <label for="school">School</label>
    <input type="text" class="form-control autocomplete" name="school" data-type="school" id="schoolInput" required>
  </div>

  <div class="col-md-6">
    <label for="club">Club (optional)</label>
    <input type="text" class="form-control autocomplete" name="club" data-type="club" id="clubInput">
  </div>

  <div class="col-md-12">
    <button type="submit" class="btn btn-primary">â• Add Child</button>
  </div>
</form>


<script src="https://cdn.jsdelivr.net/npm/bootstrap-autocomplete@1.0.7/dist/bootstrap-autocomplete.min.js"></script>
<script>
  document.querySelectorAll('.autocomplete').forEach(input => {
    const type = input.dataset.type;

    new window.Autocomplete(input, {
      threshold: 1,
      onSearch: async ({ currentValue }) => {
        const res = await fetch(`/organizations/autocomplete?term=${encodeURIComponent(currentValue)}&type=${type}`);
        return await res.json();
      },
      onResults: ({ matches }) =>
        matches.map(m => `<li class="dropdown-item" data-value="${m.value}">${m.label}</li>`),
      onSubmit: ({ value }) => {
        input.value = value;
      }
      
    });
  });
</script>


<%- include('partials/footer1') %>
