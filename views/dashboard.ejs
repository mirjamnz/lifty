<%- include('partials/header1') %>
<%- include('partials/navbar1') %>

<div class="container py-5">
  <h2 class="mb-4">ğŸ‘‹ Welcome <%= session.userName %>!</h2>

  <!-- Children Section -->
  <div class="mb-5">
    <h4 class="mb-3">Your Children</h4>

    <% if (children.length > 0) { %>
      <ul class="list-group mb-4">
        <% children.forEach(child => { %>
          <li class="list-group-item d-flex justify-content-between align-items-center">
            <div>
              <strong><%= child.name %></strong> â€“ <%= child.school %>
              <% if (child.club) { %> | Club: <%= child.club %> <% } %>
            </div>
            <div>
              <button class="btn btn-sm btn-outline-secondary me-2" data-bs-toggle="collapse" data-bs-target="#editForm<%= child.id %>">âœï¸ Edit</button>
              <a href="/delete-child/<%= child.id %>" class="btn btn-sm btn-outline-danger">ğŸ—‘ Delete</a>
            </div>
          </li>
          <li class="list-group-item collapse" id="editForm<%= child.id %>">
            <form action="/edit-child/<%= child.id %>" method="POST" class="row g-2">
              <div class="col-md-4">
                <input type="text" name="name" value="<%= child.name %>" class="form-control" required>
              </div>
              <div class="col-md-4">
                <input type="text" name="school" value="<%= child.school %>" class="form-control" required>
              </div>
              <div class="col-md-3">
                <input type="text" name="club" value="<%= child.club %>" class="form-control" placeholder="Club (optional)">
              </div>
              <div class="col-md-1">
                <button type="submit" class="btn btn-primary w-100">ğŸ’¾</button>
              </div>
            </form>
          </li>
        <% }) %>
      </ul>
    <% } else { %>
      <p class="text-muted">No children registered yet.</p>
    <% } %>

    <!-- Add New Child Form -->
    <h5 class="mt-4">â• Add New Child</h5>
    <form action="/add-child" method="POST" class="row g-2 mt-2">
      <div class="col-md-4">
        <input type="text" name="name" class="form-control" placeholder="Child's Name" required>
      </div>
      <div class="col-md-4">
        <input type="text" name="school" class="form-control" placeholder="School" required>
      </div>
      <div class="col-md-3">
        <input type="text" name="club" class="form-control" placeholder="Club (optional)">
      </div>
      <div class="col-md-1">
        <button type="submit" class="btn btn-success w-100">Add</button>
      </div>
    </form>
  </div>

  <!-- Rides Section -->
  <div class="mb-5">
    <h4>Available Rides</h4>
    <% if (rides.length > 0) { %>
      <table class="table table-striped">
        <thead>
          <tr>
            <th>Driver</th>
            <th>Pickup</th>
            <th>Dropoff</th>
            <th>Time</th>
            <th>Seats</th>
          </tr>
        </thead>
        <tbody>
          <% rides.forEach(ride => { %>
            <tr>
              <td><%= ride.driver_name %></td>
              <td><%= ride.pickup_location %></td>
              <td><%= ride.dropoff_location %></td>
              <td><%= new Date(ride.pickup_time).toLocaleString() %></td>
              <td><%= ride.seats_available %></td>
            </tr>
          <% }) %>
        </tbody>
      </table>
    <% } else { %>
      <p class="text-muted">No rides available right now.</p>
    <% } %>
  </div>

  <!-- Ride Offer / Request Section -->
  <div class="mb-5">
    <h4 class="mb-3">ğŸš— Ride Sharing</h4>
    <div class="row">
      <div class="col-md-6">
        <h5>Offer a Ride</h5>
        <form action="/offer-ride" method="POST" class="mb-4">
          <div class="mb-2">
            <input type="text" name="pickup_location" class="form-control" placeholder="Pickup Location" required>
          </div>
          <div class="mb-2">
            <input type="text" name="dropoff_location" class="form-control" placeholder="Dropoff Location" required>
          </div>
          <div class="mb-2">
            <input type="number" name="seats_available" class="form-control" placeholder="Seats Available" min="1" required>
          </div>
          <button type="submit" class="btn btn-primary">ğŸš— Offer Ride</button>
        </form>
      </div>
      <div class="col-md-6">
        <h5>Request a Pickup</h5>
        <form action="/request-ride" method="POST">
          <div class="mb-2">
            <input type="text" name="pickup_location" class="form-control" placeholder="Pickup Location" required>
          </div>
          <div class="mb-2">
            <input type="text" name="dropoff_location" class="form-control" placeholder="Dropoff Location (optional)">
          </div>
          <div class="mb-2">
            <textarea name="note" class="form-control" placeholder="Additional details... (optional)"></textarea>
          </div>
          <button type="submit" class="btn btn-outline-success">ğŸ“£ Request Pickup</button>
        </form>
      </div>
    </div>
  </div>
</div>

<%- include('partials/footer1') %>
